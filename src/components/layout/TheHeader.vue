<template>
  <header class="header-container">
    <div class="header_container__logo">
      <router-link to="/" class="header-container__logo-name">Буклиб</router-link>
      <span>Интернет-магазин книг</span>
    </div>

    <div class="header">
      <Button @click="router.push('/catalog')">
        <font-awesome-icon icon="book" class="icon-book"/>
        <span style="padding-left: 8px">Каталог</span>
      </Button>
      <AutoComplete v-model="query" optionLabel="description" placeholder="Я ищу..." :suggestions="books" @complete="search" @item-select="change"/>
    </div>

    <div class="header-right">
        <MessageDialog :message="message" @close="message=''"/>
        <LoginDialog v-if="loginDialogVisible" @auth="onLoginAuth()" @cancel="onLoginCancel()" />
        <div @click="onNavClick('/profile')" :class="['pointer', route.path === '/profile' ? 'active' : 'normal']">
          <div class="header-right-item">
            <font-awesome-icon icon="user" class="icon"/>
            <span>{{ store.state.login || "Войти" }}</span>
          </div>
        </div>
        <div @click="onNavClick('/favorite')" :class="['pointer', route.path === '/favorite' ? 'active' : 'normal']">
          <div class="header-right-item">
            <font-awesome-icon icon="heart" class="icon"/>
            <span>Избранное</span>
          </div>
        </div>
        <div @click="onNavClick('/cart')" :class="['pointer', route.path === '/cart' ? 'active' : 'normal']">
          <div class="header-right-item">
            <font-awesome-icon icon="shopping-cart" class="icon"/>
            <span>Корзина</span>
          </div>
        </div>
      </div>
  </header>
</template>

<script setup>

import { useStore } from 'vuex'
import { useRouter, useRoute  } from "vue-router";
import LoginDialog from '@/components/LoginDialog.vue';
import MessageDialog from '@/components/MessageDialog.vue';
import { ref } from 'vue'
import { getBooks } from '@/api/api';

// const menu = [
//   {
//     name: 'Каталог',
//     path: '/catalog'
//   },
//   {
//     name: 'Название',
//     path: '/path'
//   },
//   {
//     name: 'Название',
//     path: '/path'
//   },
//   {
//     name: 'Название',
//     path: '/path'
//   }
// ]

const store = useStore();
const router = useRouter();
const route = useRoute();
const loginDialogVisible = ref();
const message = ref('');
const query = ref('');
const books = ref([]);

const onNavClick = path => {
  if (store.state.login) {
    router.push(path);
  } else if (path === "/profile") {
    loginDialogVisible.value = true;
  } else {
    message.value = "Вход не выполнен";
  }
};

const onLoginAuth = () => {
  loginDialogVisible.value = false;
  router.push("/");
};

const onLoginCancel = () => {
  loginDialogVisible.value = false;
};

const search = async e => {
  const newBooks = await getBooks(false, {query: e.query});
  books.value = newBooks.map(book => ({...book, description: book.title + " " + book.author, query: e.query}));
};

const change = e => {
  router.push(`/books/${e.value.book_id}`);
  query.value = e.value.query;
};

</script>

<style scoped>

.header-container {
  /*position:fixed;*/
  background:white;
  width: 100%;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  align-items: center;
  border-bottom:1px solid var(--black);
}

.header_container__logo{
  display: flex;
  flex-direction: column;
  align-items:center;
}

.header-container__logo-name {
  font-family: 'Playfair', serif;
  color:var(--black);
  font-size: 40px;
  font-weight:bold;
}

.header-container__logo-name:hover{
  color:var(--red);
}

.header_container__logo span{
  font-family: 'Playfair', serif;
}

.header-container__search-catalog{
  display:flex;
}

.catalog_link{
  color:var(--white);
  font-weight:bold;
}

.header {
  display: flex;
  align-items: center;
  gap: 8px;
}

.icon-book{
  color:var(--white);
  padding-left:5px;
}

.header-right {
  display: flex;
  justify-content: flex-end;
  gap: 16px;
  padding: 0 16px;
}

.header-right-item {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.icon {
  padding: 8px;
  width: 24px;
  height: 24px;
}

.active {
  color: #F76C6C;
}

.normal {
  color: #2f2e2e;
}

.header-right-item span {
  font-size: 14px;
}

.pointer {
  cursor: pointer;
}

</style>
